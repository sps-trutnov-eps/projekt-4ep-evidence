@model EvidenceProject.Controllers.ActionData.ProfileData

@if(Model == null) return;

@if(Model.AuthUser != null){
    <h2>Profil</h2>
    <form method="post" action="/user/change">
        <label for="firstname">Jméno:</label>
        <input type="text" name="firstname" value="@Model.AuthUser.fullName?.Split("")[0]" required>
        <label for="lastname">Příjmení:</label>
        @{

            if (Model.AuthUser.fullName?.Split("").Length == 2)
            {
                    <input type="text" name="lastname" value="@Model.AuthUser.fullName?.Split("")[1]" required>
            }
            else{
                    <input type="text" name="lastname" required>
            }
        }
        <label for="contact">Kontakt(email, github,..):</label>
        <input type="text" name="contact" value="@Model.AuthUser.contactDetails" required>
        <label for="studyField">Obor:</label>
        <input type="text" name="studyField" list="obory" value="@Model.AuthUser.studyField"  required>
        <label for="schoolYear">Ročník:</label>
        <input type="text" name="schoolYear" list="rocniky" value="@Model.AuthUser.schoolYear">
        <label for="username">Uživatelské jméno:</label>
        <input type="text" name="username" value="@Model.AuthUser.username" required>
        <label for="password">Heslo:</label>
        <input type="password" name="password" required>
        <input type="submit" value="Změnit">
    </form>
}

@if(Model.Projects != null)
{
    <div id="projects">
    <h2>Projekty</h2>
    @foreach(var project in Model.Projects.OrderBy(x => x.projectManager?.id == Model.AuthUser.id))
    {
        <p>@project.name</p>
        if(project.projectManager.id == Model.AuthUser?.id)
        {
            <a href="/project/edit/@project.id">Editovat</a>
        }
    }
    </div>
}
@if(Model.Users != null){
    <div id="user">
    <h2>Všichni uživatelé</h2>
    @foreach (var user in Model.Users)
    {
        <p>Uživatel: @user.fullName</p>
        <form method="post" action="/user/edit/">
            <label for="firstname">Jméno:</label>
            <input type="text" name="firstname" value="@user.fullName?.Split("")[0]" required>
            <label for="lastname">Příjmení:</label>
            @{

                if (user.fullName?.Split("").Length == 2)
                {
                        <input type="text" name="lastname" value="@user.fullName?.Split("")[1]" required>
                }
                else{
                        <input type="text" name="lastname" required>
                }
            }
            <label for="contact">Kontakt(email, github,..):</label>
            <input type="text" name="contact" value="@user.contactDetails" required>
            <label for="studyField">Obor:</label>
            <input type="text" name="studyField" list="obory" value="@user.studyField" required>
            <label for="schoolYear">Ročník:</label>
            <input type="text" name="schoolYear" list="rocniky" value="@user.schoolYear" required>
            <label for="username">Uživatelské jméno:</label>
            <input type="text" name="username" value="@user.username" required>
            <label for="password">Heslo:</label>
            <input type="hidden" name="userId" value="@user.id">
            <input type="password" name="password" required>
            <input type="submit" value="Změnit">
        </form>
    }
    </div>
}

@if(Model.Categories != null){
    <div id="categories">
    <h2>Úprava kategorií</h2>
    @foreach (var category in Model.Categories)
    {
        <p>Název kategorie: @category.name</p>
            <form action="/dialinfo/edit">
            <label for="name">Název kategorie:</label>
            <input name="name" type="text" placeholder="..." id="name" value="@category.name"/>
            <label for="description">Popis:</label>
            <input name="description" type="text" placeholder="..." id="description" value="@category.desc" />
            <input type="hidden" value="@category.id" />
            <input type="submit" placeholder="Změnit" />
        </form>
        
        @foreach(var categoryItem in category?.dialCodes?.ToList()){
            <p>@category.name -> @categoryItem.name</p>
            <form action="/dialcode/edit">
                <label for="name">Název:</label>
                <input name="name" type="text" placeholder="..." id="name" value="@categoryItem.name" />
                <label for="description">Popis:</label>
                <input name="description" type="text" placeholder="..." id="description" value="@categoryItem.description" />
                <label>Barva</label>
                <input type="color" name="color" value="@UniversalHelper.GetHtmlColor(categoryItem.color)" />
                <label>Kategorie</label>
                <input name="dialInfoName" list="stavy" value="@categoryItem.dialInfo.name"/>
                <input type="hidden" value="@categoryItem.id" />
                <input type="submit" placeholder="Změnit" />
            </form>
        }
    }
    </div>
}

    
@await Html.PartialAsync("../Shared/DatalistsPV")


